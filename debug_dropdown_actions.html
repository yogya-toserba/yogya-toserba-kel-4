<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Debug Dropdown Actions</title>
        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
    </head>
    <body>
        <div class="container mt-4">
            <h3>üîç Debug Dropdown Actions - Penggajian</h3>

            <div class="alert alert-info">
                <h5>Debug Steps:</h5>
                <ol>
                    <li>Buka halaman penggajian di tab baru</li>
                    <li>Tekan F12 untuk membuka Developer Tools</li>
                    <li>Pilih tab "Console"</li>
                    <li>Coba klik dropdown dan lihat error messages</li>
                    <li>Gunakan tombol debug di bawah untuk test manual</li>
                </ol>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5>Manual Function Test</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Test Lihat Detail</h6>
                            <input
                                type="number"
                                id="detailId"
                                placeholder="Masukkan ID Gaji"
                                class="form-control mb-2"
                                value="1"
                            />
                            <button
                                onclick="testViewDetail()"
                                class="btn btn-primary"
                            >
                                Test Lihat Detail
                            </button>
                        </div>
                        <div class="col-md-6">
                            <h6>Test Edit Gaji</h6>
                            <input
                                type="number"
                                id="editId"
                                placeholder="Masukkan ID Gaji"
                                class="form-control mb-2"
                                value="1"
                            />
                            <button
                                onclick="testEditGaji()"
                                class="btn btn-warning"
                            >
                                Test Edit Gaji
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5>Test Results</h5>
                </div>
                <div class="card-body">
                    <div
                        id="testResults"
                        style="max-height: 400px; overflow-y: auto"
                    >
                        <em>Test results will appear here...</em>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5>Quick API Test</h5>
                </div>
                <div class="card-body">
                    <button onclick="testApiEndpoint()" class="btn btn-info">
                        Test API Endpoint
                    </button>
                    <div id="apiResults" class="mt-3"></div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JavaScript -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            function logResult(message, type = "info") {
                const results = document.getElementById("testResults");
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement("div");
                logEntry.className = `alert alert-${type} p-2 mb-2`;
                logEntry.innerHTML = `<small>[${timestamp}]</small> ${message}`;
                results.appendChild(logEntry);
                results.scrollTop = results.scrollHeight;
                console.log(`[${timestamp}] ${message}`);
            }

            function testViewDetail() {
                const id = document.getElementById("detailId").value;
                logResult(`Testing viewDetail with ID: ${id}`, "primary");

                if (!id) {
                    logResult("‚ùå ID tidak boleh kosong", "danger");
                    return;
                }

                // Test modal element
                logResult("üîç Checking if we can create modal...", "info");

                // Create temporary modal for testing
                const modalHtml = `
                <div class="modal fade" id="testDetailModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Test Detail Modal</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div id="testDetailContent">
                                    <div class="text-center">
                                        <i class="fas fa-spinner fa-spin fa-3x text-primary mb-3"></i>
                                        <h5>Testing API call...</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

                // Remove existing test modal
                const existingModal =
                    document.getElementById("testDetailModal");
                if (existingModal) {
                    existingModal.remove();
                }

                // Add new modal
                document.body.insertAdjacentHTML("beforeend", modalHtml);

                try {
                    const modal = new bootstrap.Modal(
                        document.getElementById("testDetailModal")
                    );
                    logResult("‚úÖ Modal created successfully", "success");
                    modal.show();

                    // Test API call
                    const apiUrl = `http://127.0.0.1:8000/admin/penggajian/${id}/api`;
                    logResult(`üåê Testing API: ${apiUrl}`, "info");

                    fetch(apiUrl, {
                        method: "GET",
                        headers: {
                            Accept: "application/json",
                            "X-Requested-With": "XMLHttpRequest",
                        },
                    })
                        .then((response) => {
                            logResult(
                                `üì° API Response Status: ${response.status}`,
                                response.ok ? "success" : "danger"
                            );
                            return response.json();
                        })
                        .then((data) => {
                            logResult(
                                `üìÑ API Response: ${JSON.stringify(
                                    data
                                ).substring(0, 100)}...`,
                                "info"
                            );

                            const content =
                                document.getElementById("testDetailContent");
                            if (data.success) {
                                content.innerHTML = data.html;
                                logResult(
                                    "‚úÖ Detail loaded successfully!",
                                    "success"
                                );
                            } else {
                                content.innerHTML = `<div class="alert alert-danger">Error: ${data.message}</div>`;
                                logResult(
                                    `‚ùå API Error: ${data.message}`,
                                    "danger"
                                );
                            }
                        })
                        .catch((error) => {
                            logResult(
                                `‚ùå Fetch Error: ${error.message}`,
                                "danger"
                            );
                            const content =
                                document.getElementById("testDetailContent");
                            content.innerHTML = `<div class="alert alert-danger">Network Error: ${error.message}</div>`;
                        });
                } catch (error) {
                    logResult(`‚ùå Modal Error: ${error.message}`, "danger");
                }
            }

            function testEditGaji() {
                const id = document.getElementById("editId").value;
                logResult(`Testing editGaji with ID: ${id}`, "warning");

                if (!id) {
                    logResult("‚ùå ID tidak boleh kosong", "danger");
                    return;
                }

                const editUrl = `http://127.0.0.1:8000/admin/penggajian/${id}/edit`;
                logResult(`üîó Edit URL: ${editUrl}`, "info");

                // Test if URL is accessible
                fetch(editUrl, {
                    method: "GET",
                    headers: {
                        Accept: "text/html",
                    },
                })
                    .then((response) => {
                        logResult(
                            `üì° Edit Page Status: ${response.status}`,
                            response.ok ? "success" : "danger"
                        );
                        if (response.ok) {
                            logResult(
                                "‚úÖ Edit page accessible, would redirect now",
                                "success"
                            );
                            // Don't actually redirect in test
                            // window.location.href = editUrl;
                        } else {
                            logResult("‚ùå Edit page not accessible", "danger");
                        }
                    })
                    .catch((error) => {
                        logResult(
                            `‚ùå Edit Page Error: ${error.message}`,
                            "danger"
                        );
                    });
            }

            function testApiEndpoint() {
                const apiResults = document.getElementById("apiResults");
                apiResults.innerHTML =
                    '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> Testing...</div>';

                // Test if gaji data exists
                fetch("http://127.0.0.1:8000/admin/penggajian", {
                    method: "GET",
                    headers: {
                        Accept: "text/html",
                    },
                })
                    .then((response) => {
                        if (response.ok) {
                            return response.text();
                        }
                        throw new Error(`HTTP ${response.status}`);
                    })
                    .then((html) => {
                        // Try to find gaji IDs in the HTML
                        const matches = html.match(/dropdownMenuButton(\d+)/g);
                        if (matches) {
                            const ids = matches.map((m) =>
                                m.replace("dropdownMenuButton", "")
                            );
                            apiResults.innerHTML = `
                        <div class="alert alert-success">
                            <h6>‚úÖ Found Gaji IDs:</h6>
                            <p>${ids.join(", ")}</p>
                            <button onclick="testWithRealId('${
                                ids[0]
                            }')" class="btn btn-sm btn-primary">Test with ID ${
                                ids[0]
                            }</button>
                        </div>
                    `;
                        } else {
                            apiResults.innerHTML =
                                '<div class="alert alert-warning">‚ö†Ô∏è No gaji data found</div>';
                        }
                    })
                    .catch((error) => {
                        apiResults.innerHTML = `<div class="alert alert-danger">‚ùå Error: ${error.message}</div>`;
                    });
            }

            function testWithRealId(id) {
                document.getElementById("detailId").value = id;
                document.getElementById("editId").value = id;
                logResult(`üéØ Using real ID from page: ${id}`, "primary");
            }

            // Global error handler
            window.addEventListener("error", function (e) {
                logResult(`üí• Global Error: ${e.error.message}`, "danger");
            });

            logResult("üöÄ Debug page loaded successfully", "success");
        </script>
    </body>
</html>
